-- ATUALIZAR O HISTÓRICO DO LANCAMENTO DE BAIXA DE TÍTULOS: 

-- QUANDO O HISTÓRICO DO LANCAMENTO FOR VAZIO
UPDATE FINANCAS.LANCAMENTOSCONTAS L
SET HISTORICO = 'Baixa de Título '|| T.NUMERO || ' de ' || P.NOME || '. Obs: ' || COALESCE (T.OBSERVACAO, '')
FROM FINANCAS.BAIXAS B, FINANCAS.TITULOS T, NS.PESSOAS P
WHERE L.LANCAMENTOCONTA = B.LANCAMENTOCONTA
AND T.ID_PESSOA = P.ID
AND B.ID_TITULO = T.ID
AND T.SINAL = 0 -- TÍTULO A RECEBER -- TROCAR PARA 1 QUANDO FOR TÍTULO A PAGAR
AND L.LANCAMENTOCONTA IN (
SELECT LANCAMENTOCONTA FROM FINANCAS.LANCAMENTOSCONTAS 
WHERE HISTORICO IS NULL);



-- PELO PERÍODO DOS LANÇAMENTOS

-- TÍTULOS A RECEBER
UPDATE FINANCAS.LANCAMENTOSCONTAS L
SET HISTORICO = 'Baixa de Título '|| T.NUMERO || ' de ' || COALESCE (P.NOME, '') || '. Obs: ' || COALESCE (T.OBSERVACAO, '')
FROM FINANCAS.BAIXAS B, FINANCAS.TITULOS T, NS.PESSOAS P
WHERE L.LANCAMENTOCONTA = B.LANCAMENTOCONTA 
AND T.ID_PESSOA = P.ID
AND B.ID_TITULO = T.ID
AND T.SINAL = 0
--AND L.DATA BETWEEN '2016-01-01' AND '2017-12-31'; -- OPÇÃO PARA INFORMAR O PERÍODO

-- TÍTULOS A PAGAR
UPDATE FINANCAS.LANCAMENTOSCONTAS L
SET HISTORICO = 'Pagamento de Título '|| T.NUMERO || ' de ' || COALESCE (P.NOME, '') || '. Obs: ' || COALESCE (T.OBSERVACAO, '')
FROM FINANCAS.BAIXAS B, FINANCAS.TITULOS T, NS.PESSOAS P
WHERE L.LANCAMENTOCONTA = B.LANCAMENTOCONTA
AND T.ID_PESSOA = P.ID
AND B.ID_TITULO = T.ID
AND T.SINAL = 1
--AND L.DATA BETWEEN '2016-01-01' AND '2017-12-31'; -- OPÇÃO PARA INFORMAR O PERÍODO