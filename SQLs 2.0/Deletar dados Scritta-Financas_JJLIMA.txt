CREATE OR REPLACE FUNCTION APAGAR_DADOS_SCRITTA_FINANCAS()
RETURNS boolean
LANGUAGE plpgsql
AS $function$
DECLARE
 VNUMPASSOS                          INT;
BEGIN
-- CONTAGEM DO NÚMERO DE PASSOS PARA RASTREAR PROGRESSO
   VNUMPASSOS := 42;
   BEGIN
      DROP SEQUENCE IF EXISTS PASSO;
   EXCEPTION
      WHEN SQLSTATE '00000' THEN      
   END;
   create temp sequence PASSO MINVALUE 1 START with 1;
   
RAISE NOTICE 'APAGANDO AS BAIXAS... %/%',NEXTVAL('PASSO'),VNUMPASSOS;
delete from financas.baixas;
RAISE NOTICE 'APAGANDO AS CONTAS DE FORNECEDORES... %/%',NEXTVAL('PASSO'),VNUMPASSOS;
delete from financas.contasfornecedores;
RAISE NOTICE 'APAGANDO AS CONTAS PERFIS USUARIO... %/%',NEXTVAL('PASSO'),VNUMPASSOS;
delete from financas.contasperfisusuario;
RAISE NOTICE 'APAGANDO AS ALTERAÇÕES DE CONTRATOS... %/%',NEXTVAL('PASSO'),VNUMPASSOS;
DELETE FROM FINANCAS.ALTERACOESCONTRATOS;
RAISE NOTICE 'APAGANDO OS ITENS DE CONTRATOS... %/%',NEXTVAL('PASSO'),VNUMPASSOS;
delete from financas.itenscontratos;
RAISE NOTICE 'APAGANDO OS CONTRATOS... %/%',NEXTVAL('PASSO'),VNUMPASSOS;
delete from financas.contratos;
RAISE NOTICE 'APAGANDO OS RATEIOS FINACNEIROS... %/%',NEXTVAL('PASSO'),VNUMPASSOS;
delete from financas.rateiosfinanceiros;
RAISE NOTICE 'APAGANDO A FILA DE PROCESSAMENTO DO FLUXO DE CAIXA... %/%',NEXTVAL('PASSO'),VNUMPASSOS;
delete from financas.filaprocessamentofluxocaixa;
RAISE NOTICE 'APAGANDO OS ITENS DE CHEQUES... %/%',NEXTVAL('PASSO'),VNUMPASSOS;
delete from financas.itenschequespagamentos;
RAISE NOTICE 'APAGANDO OS CHEQUES... %/%',NEXTVAL('PASSO'),VNUMPASSOS;
delete from financas.chequespagamentos;
RAISE NOTICE 'APAGANDO OS LANÇAMENTOS DAS CONTAS... %/%',NEXTVAL('PASSO'),VNUMPASSOS;
delete from financas.lancamentoscontas;
RAISE NOTICE 'APAGANDO AS REJEIÇÕES BANCÁRIAS... %/%',NEXTVAL('PASSO'),VNUMPASSOS;
delete from financas.ocorrenciasbancariasrejeicoes;
RAISE NOTICE 'APAGANDO TABELA tiposcontaspagamentosbancosformaspagbanco... %/%',NEXTVAL('PASSO'),VNUMPASSOS;
delete from financas.tiposcontaspagamentosbancosformaspagbanco;
RAISE NOTICE 'APAGANDO OS TIPOS DE CONTAS POR PAGAMENTOS BANCOS... %/%',NEXTVAL('PASSO'),VNUMPASSOS;
delete from financas.tiposcontaspagamentosbancos;
RAISE NOTICE 'APAGANDO TABELA tiposcontaspagamentosns... %/%',NEXTVAL('PASSO'),VNUMPASSOS;
delete from financas.tiposcontaspagamentosns;
RAISE NOTICE 'APAGANDO OS TÍTULOS POR VENDEDORES... %/%',NEXTVAL('PASSO'),VNUMPASSOS;
delete from financas.titulosreceberporvendedores;
RAISE NOTICE 'APAGANDO OS TÍTULOS... %/%',NEXTVAL('PASSO'),VNUMPASSOS;
delete from financas.titulos;
RAISE NOTICE 'APAGANDO AS IRREGULARIDADES BANCÁRIAS... %/%',NEXTVAL('PASSO'),VNUMPASSOS;
DELETE FROM FINANCAS.IRREGULARIDADESBANCARIAS;
RAISE NOTICE 'APAGANDO OS BOLETOS BANCÁRIOS... %/%',NEXTVAL('PASSO'),VNUMPASSOS;
DELETE FROM FINANCAS.BOLETOSBANCARIOS;
RAISE NOTICE 'APAGANDO OS PAGAMENTOS... %/%',NEXTVAL('PASSO'),VNUMPASSOS;
DELETE FROM NS.DF_PAGAMENTOS;
RAISE NOTICE 'APAGANDO TABELA LF_SERVICOS... %/%',NEXTVAL('PASSO'),VNUMPASSOS;
DELETE FROM SCRITTA.LF_SERVICOS;
RAISE NOTICE 'APAGANDO TABELA LF_ITENS... %/%',NEXTVAL('PASSO'),VNUMPASSOS;
DELETE FROM SCRITTA.LF_ITENS;
RAISE NOTICE 'APAGANDO TABELA LF_LANFIS... %/%',NEXTVAL('PASSO'),VNUMPASSOS;
DELETE FROM SCRITTA.LF_LANFIS;
RAISE NOTICE 'APAGANDO TABELA DF_LINHAS... %/%',NEXTVAL('PASSO'),VNUMPASSOS;
DELETE FROM NS.DF_LINHAS;
RAISE NOTICE 'APAGANDO TABELA DF_LINHAS... %/%',NEXTVAL('PASSO'),VNUMPASSOS;
DELETE FROM ESTOQUE.itens_mov;
RAISE NOTICE 'APAGANDO TABELA DF_ITENS... %/%',NEXTVAL('PASSO'),VNUMPASSOS;
DELETE FROM NS.DF_ITENS;
RAISE NOTICE 'APAGANDO TABELA DF_SERVICOS... %/%',NEXTVAL('PASSO'),VNUMPASSOS;
DELETE FROM NS.DF_SERVICOS;
RAISE NOTICE 'APAGANDO TABELA DF_DOCFIS... %/%',NEXTVAL('PASSO'),VNUMPASSOS;
DELETE FROM NS.DF_DOCFIS where id_estabelecimento in ('b060c101-22a7-4f3b-b3ec-bf57b8ceefe4', '402eec5c-c961-4a92-9e8b-2a3dbcbbf4b2');
RAISE NOTICE 'APAGANDO OS DOCUMENTOS RATEADOS... %/%',NEXTVAL('PASSO'),VNUMPASSOS;
delete from financas.documentosrateados;
RAISE NOTICE 'APAGANDO OS conjuntos de serviços... %/%',NEXTVAL('PASSO'),VNUMPASSOS;
delete from ns.conjuntosservicos;
RAISE NOTICE 'APAGANDO OS SERVIÇOS... %/%',NEXTVAL('PASSO'),VNUMPASSOS;
delete from servicos.servicos;
RAISE NOTICE 'APAGANDO AS CLASSIFICAÇÕES FINANCEIRAS... %/%',NEXTVAL('PASSO'),VNUMPASSOS;
delete from financas.classificacoesfinanceiras;
RAISE NOTICE 'APAGANDO TABELA CONTASPADROES... %/%',NEXTVAL('PASSO'),VNUMPASSOS;
DELETE FROM NS.CONTASPADROES;
RAISE NOTICE 'APAGANDO SERIES... %/%',NEXTVAL('PASSO'),VNUMPASSOS;
DELETE FROM NS.SERIES; 
delete from scritta.od_outdoc where id_estabelecimento in ('b060c101-22a7-4f3b-b3ec-bf57b8ceefe4', '402eec5c-c961-4a92-9e8b-2a3dbcbbf4b2');
RAISE NOTICE 'APAGANDO TABELA OD_GRUOUT... %/%',NEXTVAL('PASSO'),VNUMPASSOS;
DELETE FROM SCRITTA.OD_GRUOUT where id_empresa in ('404b01c0-ff79-4f2f-aeed-3b9bdbb6497c', 'd1750a31-f973-4610-9a2e-562b6b752fd8');
RAISE NOTICE 'APAGANDO TABELA SN_CFG... %/%',NEXTVAL('PASSO'),VNUMPASSOS;
DELETE FROM SCRITTA.SN_CFG;
RAISE NOTICE 'APAGANDO AS CONTAS... %/%',NEXTVAL('PASSO'),VNUMPASSOS;
update ns.pessoas set id_conta_receber = NULL;
delete from financas.contas;
RAISE NOTICE 'APAGANDO OS TIPOS DE CONTAS... %/%',NEXTVAL('PASSO'),VNUMPASSOS;
delete from financas.tiposcontas;
RAISE NOTICE 'APAGANDO TABELA GREC_CFG... %/%',NEXTVAL('PASSO'),VNUMPASSOS;
DELETE FROM scritta.grec_cfg;
RAISE NOTICE 'APAGANDO TABELA GREC_ICMS_ISS... %/%',NEXTVAL('PASSO'),VNUMPASSOS;
delete from scritta.grec_icms_iss;
RAISE NOTICE 'APAGANDO TABELA GREC_RESUMO... %/%',NEXTVAL('PASSO'),VNUMPASSOS;
delete from scritta.grec_resumo;
RAISE NOTICE 'APAGANDO OS GRUPOS NAO UTILIZADOS... %/%',NEXTVAL('PASSO'),VNUMPASSOS;
DELETE FROM NS.GRUPOSEMPRESARIAIS WHERE CODIGO NOT IN ('JJLIMA', 'JJTECNOL');

RETURN TRUE;
END;
$function$
;

SELECT APAGAR_DADOS_SCRITTA_FINANCAS();